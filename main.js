(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),function(e){document.addEventListener("keydown",n),e.addEventListener("click",o)}(e)}function t(e){e.classList.remove("popup_is-opened"),function(e){document.removeEventListener("keydown",n),e.removeEventListener("click",o)}(e)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function o(e){e.target.classList.contains("popup_is-opened")&&t(e.target)}function r(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}const c={baseUrl:"https://nomoreparties.co/v1/wff-cohort-37",headers:{authorization:"8440a291-0f0b-4349-8150-1e5205f18db6","Content-Type":"application/json"}};function i(e){return Promise.reject(`Ошибка: ${e.status}`)}function u(e,t,n,o,u,a){const l=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),s=l.querySelector(".card__like-button"),d=l.querySelector(".card__delete-button"),p=l.querySelector(".card__image"),_=l.querySelector(".card__title"),f=l.querySelector(".like__count");return p.src=e,_.textContent=t,p.alt=t,f.textContent=u.cardLikes.length,u.cardLikes.some((e=>e._id===a))&&s.classList.add("card__like-button_is-active"),p.addEventListener("click",n),d.addEventListener("click",(function(e){o(e.target,u.cardId)})),s.addEventListener("click",(function(e){const t=e.target;!function(e,t,n){t.classList.contains("card__like-button_is-active")?t.classList.contains("card__like-button_is-active")&&function(e){return fetch(`${c.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:c.headers}).then(r)}(e).then((e=>{t.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length})).catch(i):function(e){return fetch(`${c.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:c.headers}).then(r)}(e).then((e=>{t.classList.add("card__like-button_is-active"),n.textContent=e.likes.length})).catch(i)}(u.cardId,t,f)})),l}function a(e,t){(function(e){return fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(r)})(t).then((()=>{e.closest(".card").remove()})).catch(i)}function l(e,t){e.disabled=!0,e.classList.add(t)}function s(e,t,n,o,r){!function(e,t){e.disabled=!1,e.classList.remove(t)}(o,r),e.classList.remove(t),n.textContent=""}function d(e,t){const n=e.querySelectorAll(t.inputSelector),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){const r=e.querySelector(`.${n.id}__error_text`);s(n,t.inputErrorSelector,r,o,t.buttonDisabledSelector),l(o,t.buttonDisabledSelector)}))}let p;const _=document.querySelector(".content"),f=(Array.from(document.querySelectorAll(".form")),_.querySelector(".profile__add-button")),m=document.querySelector(".popup_type_new-card"),b=m.querySelector(".popup__close"),h=_.querySelector(".places__list"),S=document.querySelector(".popup_type_image"),v=S.querySelector(".popup__image"),y=S.querySelector(".popup__caption"),E=S.querySelector(".popup__close"),k=document.querySelector(".profile__edit-button"),L=document.querySelector(".popup_type_edit"),q=L.querySelector(".popup__close"),g=document.querySelector(".profile__info"),C=document.getElementById("avatar"),x=g.querySelector(".profile__title"),$=g.querySelector(".profile__description"),D=document.querySelector(".profile__image_change_button"),w=document.querySelector(".popup_type_changeAvatar"),U=w.querySelector(".popup__close"),A=document.forms.newPlace,I=A.elements.link,P=A.elements.placeName,B=document.forms.editAvatar,T=B.elements.avatarLink,N=document.forms.editProfile,j=N.elements.name,O=N.elements.description;var J;function M(e,t,n="Сохранить",o="Сохранение..."){t.textContent=e?o:n}function H(e,t="Сохранение..."){const n=e.submitter;M(!0,n,n.textContent,t)}function V(t){const n=t.target;e(S),v.src=n.src,y.textContent=n.alt,v.alt=n.alt}J={formSelector:".popup__form",inputSelector:".popup__input",inputErrorSelector:"popup__input_validationError",submitButtonSelector:".popup__button",buttonDisabledSelector:"popup__button_disabled"},document.querySelectorAll(J.formSelector).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),e.querySelectorAll(J.inputSelector).forEach((function(t){t.addEventListener("input",(function(){const n=e.querySelector(J.submitButtonSelector),o=e.querySelector(`.${t.id}__error_text`);!function(e,t,n,o,r){!function(e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity("")}(e),e.validity.valid?s(e,t,o,n,r):function(e,t,n,o,r){l(o,r),e.classList.add(t),n.textContent=e.validationMessage}(e,t,o,n,r)}(t,J.inputErrorSelector,n,o,J.buttonDisabledSelector)}))}))})),Promise.all([fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(r),fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(r)]).then((([e,t])=>{p=e._id,x.textContent=e.name,$.textContent=e.about,C.style.backgroundImage=`url('${e.avatar}')`,t.forEach((function(e){h.prepend(u(e.link,e.name,V,a,{cardId:e._id,cardLikes:e.likes,ownerId:e.owner._id},p)),e.owner._id!==p&&document.querySelector(".card__delete-button").remove()}))})).catch(i),E.addEventListener("click",(function(){t(S)})),D.addEventListener("click",(function(){e(w),d(B,{inputSelector:".popup__input",inputErrorSelector:"popup__input_validationError",submitButtonSelector:".popup__button",buttonDisabledSelector:"popup__button_disabled"}),T.value=""})),U.addEventListener("click",(function(){t(w)})),B.addEventListener("submit",(function(e){e.preventDefault(),function(e,n){H(n),function(e){return fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(r)}(e).then((()=>{C.style.backgroundImage=`url('${e}')`,t(w),B.reset()})).catch(i).finally((()=>{M(!1,n.submitter,"Сохранить")}))}(T.value,e)})),k.addEventListener("click",(function(){e(L),d(N,{inputSelector:".popup__input",inputErrorSelector:"popup__input_validationError",submitButtonSelector:".popup__button",buttonDisabledSelector:"popup__button_disabled"}),j.value=x.textContent,O.value=$.textContent})),q.addEventListener("click",(function(){t(L)})),N.addEventListener("submit",(function(e){e.preventDefault(),function(e,n,o){H(o),function(e,t){return fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(r)}(e,n).then((()=>{x.textContent=e,$.textContent=n,t(L),N.reset()})).catch(i).finally((()=>{M(!1,o.submitter,"Сохранить")}))}(j.value,O.value,e)})),f.addEventListener("click",(function(){e(m),d(A,{inputSelector:".popup__input",inputErrorSelector:"popup__input_validationError",submitButtonSelector:".popup__button",buttonDisabledSelector:"popup__button_disabled"}),I.value="",P.value=""})),b.addEventListener("click",(function(){t(m)})),A.addEventListener("submit",(function(e){e.preventDefault(),H(e),function(e,t){return fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(r)}(P.value,I.value).then((e=>{t(m),A.reset(),h.prepend(u(e.link,e.name,V,a,{cardId:e._id,cardLikes:e.likes,ownerId:e.owner._id}))})).catch(i).finally((()=>{M(!1,e.submitter,"Сохранить")}))}))})();