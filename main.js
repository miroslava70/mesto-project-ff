(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),function(e){document.addEventListener("keydown",n),e.addEventListener("click",o)}(e)}function t(e){e.classList.remove("popup_is-opened"),function(e){document.removeEventListener("keydown",n),e.removeEventListener("click",o)}(e)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function o(e){e.target===document.querySelector(".popup_is-opened")&&t(document.querySelector(".popup_is-opened"))}const r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-37",headers:{authorization:"8440a291-0f0b-4349-8150-1e5205f18db6","Content-Type":"application/json"}},c="0371b41890700bf02786bd36";function s(e,t,n,o){const s=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=s.querySelector(".card__like-button"),a=s.querySelector(".card__delete-button"),u=s.querySelector(".card__image"),l=s.querySelector(".card__title"),d=s.querySelector(".like__count");return u.src=e,l.textContent=t,u.alt=t,function(e,t){return fetch(`${r.baseUrl}/cards`,{method:"POST",headers:r.headers,body:JSON.stringify({name:e,link:t})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}(t,e).then((e=>{e.owner._id!==c&&a.remove(),u.addEventListener("click",n),a.addEventListener("click",(function(t){const n=t.target;o(n,e._id)})),i.addEventListener("click",(function(t){const n=t.target;!function(e,t,n){t.classList.contains("card__like-button_is-active")?t.classList.contains("card__like-button_is-active")&&function(e){return fetch(`${r.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:r.headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}(e).then((e=>{t.classList.remove("card__like-button_is-active"),console.log(e.likes),n.textContent=e.likes.length})):function(e){return fetch(`${r.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:r.headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}(e).then((e=>{t.classList.add("card__like-button_is-active"),console.log(e.likes),n.textContent=e.likes.length}))}(e._id,n,d)}))})),s}function i(e,t){(function(e){return fetch(`${r.baseUrl}/cards/${e}`,{method:"DELETE",headers:{authorization:"8440a291-0f0b-4349-8150-1e5205f18db6"}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))})(t).then((()=>{e.closest(".card").remove()}))}function a(e){const t=e.querySelectorAll(".popup__input"),n=e.querySelector(".popup__button");t.forEach((function(t){const o=e.querySelector(`.${t.id}__error_text`);t.classList.remove("popup__input_validationError"),o.textContent="",n.disabled=!0,n.classList.add("popup__button_disabled")}))}const u=document.querySelector(".content"),l=Array.from(document.querySelectorAll(".form")),d=u.querySelector(".profile__add-button"),p=document.querySelector(".popup_type_new-card"),_=p.querySelector(".popup__close"),f=u.querySelector(".places__list"),m=document.querySelector(".popup_type_image"),v=m.querySelector(".popup__image"),h=m.querySelector(".popup__caption"),y=m.querySelector(".popup__close"),b=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit"),S=k.querySelector(".popup__close"),q=document.querySelector(".profile__info"),L=document.getElementById("avatar"),E=q.querySelector(".profile__title"),g=q.querySelector(".profile__description"),$=document.querySelector(".profile__image_change_button"),C=document.querySelector(".popup_type_changeAvatar"),x=C.querySelector(".popup__close"),j=document.forms.newPlace,P=j.elements.link,U=j.elements.placeName,A=document.forms.editAvatar,T=A.elements.avatarLink,w=document.forms.editProfile,D=w.elements.name,N=w.elements.description;function z(t){const n=t.target;e(m),v.src=n.src,h.textContent=n.alt,v.alt=n.alt}!function(e){e.forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),e.querySelectorAll(".popup__input").forEach((function(t){t.addEventListener("input",(function(){const n=e.querySelector(".popup__button"),o=e.querySelector(`.${t.id}__error_text`);!function(e,t,n){e.validity.valid?function(e,t,n){n.disabled=!1,n.classList.remove("popup__button_disabled"),e.classList.remove("popup__input_validationError"),t.textContent=""}(e,n,t):function(e,t,n){n.disabled=!0,n.classList.add("popup__button_disabled"),e.classList.add("popup__input_validationError"),t.textContent=e.validationMessage}(e,n,t)}(t,n,o)}))}))}))}(l),fetch(`${r.baseUrl}/users/me`,{headers:{authorization:"8440a291-0f0b-4349-8150-1e5205f18db6"}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((e=>{E.textContent=e.name,g.textContent=e.about,L.style.backgroundImage=`url('${e.avatar}')`})).catch((e=>{console.log(e)})),y.addEventListener("click",(function(){t(m)})),$.addEventListener("click",(function(){e(C),a(A),T.value=""})),x.addEventListener("click",(function(){t(C)})),A.addEventListener("submit",(function(e){var n;e.preventDefault(),e.target.textContent="Сохранение...",t(C),a(A),n=T.value,L.style.backgroundImage=`url('${n}')`,function(e){fetch(`${r.baseUrl}/users/me/avatar`,{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}(n),A.reset()})),b.addEventListener("click",(function(){e(k),a(w),D.value=E.textContent,N.value=g.textContent})),S.addEventListener("click",(function(){t(k)})),w.addEventListener("submit",(function(e){var n,o;e.preventDefault(),e.target.textContent="Сохранение...",a(w),t(k),n=D.value,o=N.value,E.textContent=n,g.textContent=o,function(e,t){fetch(`${r.baseUrl}/users/me`,{method:"PATCH",headers:r.headers,body:JSON.stringify({name:e,about:t})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}(n,o),w.reset()})),d.addEventListener("click",(function(){e(p),a(j),P.value="",U.value=""})),_.addEventListener("click",(function(){t(p)})),fetch(`${r.baseUrl}/cards`,{headers:{authorization:"8440a291-0f0b-4349-8150-1e5205f18db6"}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((e=>{e.forEach((function(e){f.prepend(s(e.link,e.name,z,i)),console.log(e),document.querySelector(".like__count").textContent=e.likes.length,e.likes.some((e=>e._id===c))&&document.querySelector(".card__like-button").classList.add("card__like-button_is-active")}))})).catch((e=>{console.log(e)})),j.addEventListener("submit",(function(e){e.preventDefault(),e.target.textContent="Сохранение...",a(j),t(p),f.prepend(s(P.value,U.value,z,i)),j.reset()}))})();