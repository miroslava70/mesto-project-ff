(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),function(e){document.addEventListener("keydown",n),e.addEventListener("click",o)}(e)}function t(e){e.classList.remove("popup_is-opened"),function(e){document.removeEventListener("keydown",n),e.removeEventListener("click",o)}(e)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function o(e){e.target.classList.contains(".popup_is-opened")&&t(document.querySelector(".popup_is-opened"))}function r(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}const c={baseUrl:"https://nomoreparties.co/v1/wff-cohort-37",headers:{authorization:"8440a291-0f0b-4349-8150-1e5205f18db6","Content-Type":"application/json"}};function i(e,t,n,o,i){const u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=u.querySelector(".card__like-button"),s=u.querySelector(".card__delete-button"),l=u.querySelector(".card__image"),d=u.querySelector(".card__title"),p=u.querySelector(".like__count");return l.src=e,d.textContent=t,l.alt=t,l.addEventListener("click",n),s.addEventListener("click",(function(e){o(e.target,i)})),a.addEventListener("click",(function(e){const t=e.target;!function(e,t,n){t.classList.contains("card__like-button_is-active")?t.classList.contains("card__like-button_is-active")&&function(e){return fetch(`${c.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:c.headers}).then(r)}(e).then((e=>{t.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length})):function(e){return fetch(`${c.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:c.headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}(e).then((e=>{t.classList.add("card__like-button_is-active"),n.textContent=e.likes.length}))}(i,t,p)})),u}function u(e,t){(function(e){return fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(r)})(t).then((()=>{e.closest(".card").remove()})).catch((e=>{console.log(e)}))}function a(e,t){e.disabled=!0,e.classList.add(t)}function s(e,t,n,o){!function(e,t){e.disabled=!1,e.classList.remove(t)}(n,o),e.classList.remove("popup__input_validationError"),t.textContent=""}function l(e){const t=e.querySelectorAll(".popup__input"),n=e.querySelector(".popup__button");t.forEach((function(t){s(t,e.querySelector(`.${t.id}__error_text`),n),a(n)}))}let d;const p=document.querySelector(".content"),_=(Array.from(document.querySelectorAll(".form")),p.querySelector(".profile__add-button")),f=document.querySelector(".popup_type_new-card"),m=f.querySelector(".popup__close"),h=p.querySelector(".places__list"),y=document.querySelector(".popup_type_image"),v=y.querySelector(".popup__image"),b=y.querySelector(".popup__caption"),S=y.querySelector(".popup__close"),k=document.querySelector(".profile__edit-button"),q=document.querySelector(".popup_type_edit"),L=q.querySelector(".popup__close"),E=document.querySelector(".profile__info"),g=document.getElementById("avatar"),C=E.querySelector(".profile__title"),$=E.querySelector(".profile__description"),x=document.querySelector(".profile__image_change_button"),P=document.querySelector(".popup_type_changeAvatar"),U=P.querySelector(".popup__close"),A=document.forms.newPlace,D=A.elements.link,j=A.elements.placeName,T=document.forms.editAvatar,w=T.elements.avatarLink,N=document.forms.editProfile,O=N.elements.name,B=N.elements.description;var I;function J(e,t,n="Сохранить",o="Сохранение..."){t.textContent=e?o:n}function M(e,t="Сохранение..."){const n=e.submitter;J(!0,n,n.textContent,t)}function H(t){const n=t.target;e(y),v.src=n.src,b.textContent=n.alt,v.alt=n.alt}I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",buttonDisabledSelector:"popup__button_disabled"},document.querySelectorAll(I.formSelector).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),e.querySelectorAll(I.inputSelector).forEach((function(t){t.addEventListener("input",(function(){const n=e.querySelector(I.submitButtonSelector),o=e.querySelector(`.${t.id}__error_text`);!function(e,t,n,o){!function(e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity("")}(e),e.validity.valid?s(e,n,t,o):function(e,t,n,o){a(n,o),e.classList.add("popup__input_validationError"),t.textContent=e.validationMessage}(e,n,t,o)}(t,n,o,I.buttonDisabledSelector)}))}))})),Promise.all([fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(r),fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(r)]).then((([e,t])=>{d=e._id,C.textContent=e.name,$.textContent=e.about,g.style.backgroundImage=`url('${e.avatar}')`,t.forEach((function(e){h.prepend(i(e.link,e.name,H,u,e._id)),document.querySelector(".like__count").textContent=e.likes.length,e.owner._id!==d&&document.querySelector(".card__delete-button").remove(),e.likes.some((e=>e._id===d))&&document.querySelector(".card__like-button").classList.add("card__like-button_is-active")}))})).catch((e=>{console.log(e)})),S.addEventListener("click",(function(){t(y)})),x.addEventListener("click",(function(){e(P),l(T),w.value=""})),U.addEventListener("click",(function(){t(P)})),T.addEventListener("submit",(function(e){e.preventDefault(),l(T),function(e,n){M(n),function(e){return fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(r)}(e).then((()=>{g.style.backgroundImage=`url('${e}')`,t(P),T.reset()})).catch((e=>{console.log(e)})).finally((()=>{J(!1,n.submitter,"Сохранить")}))}(w.value,e)})),k.addEventListener("click",(function(){e(q),l(N),O.value=C.textContent,B.value=$.textContent})),L.addEventListener("click",(function(){t(q)})),N.addEventListener("submit",(function(e){e.preventDefault(),function(e,n,o){M(o),function(e,t){return fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(r)}(e,n).then((()=>{C.textContent=e,$.textContent=n,t(q),N.reset()})).catch((e=>{console.log(e)})).finally((()=>{J(!1,o.submitter,"Сохранить")}))}(O.value,B.value,e)})),_.addEventListener("click",(function(){e(f),l(A),D.value="",j.value=""})),m.addEventListener("click",(function(){t(f)})),A.addEventListener("submit",(function(e){e.preventDefault(),M(e),function(e,t){return fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}(j.value,D.value).then((e=>{l(A),t(f),A.reset(),h.prepend(i(e.link,e.name,H,u))})).catch((e=>{console.log(e)})).finally((()=>{J(!1,e.submitter,"Сохранить")}))}))})();