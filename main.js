(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),function(e){document.addEventListener("keydown",n),e.addEventListener("click",r)}(e)}function t(e){e.classList.remove("popup_is-opened"),function(e){document.removeEventListener("keydown",n),e.removeEventListener("click",r)}(e)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function r(e){e.target.classList.contains("popup_is-opened")&&t(e.target)}function o(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}const c={baseUrl:"https://nomoreparties.co/v1/wff-cohort-37",headers:{authorization:"8440a291-0f0b-4349-8150-1e5205f18db6","Content-Type":"application/json"}};function i(e){console.error(`Ошибка: ${e.status}`)}function a(e,t,n,r,a,s){const u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=u.querySelector(".card__like-button"),d=u.querySelector(".card__delete-button"),p=u.querySelector(".card__image"),f=u.querySelector(".card__title"),_=u.querySelector(".like__count");return p.src=e,f.textContent=t,p.alt=t,a.ownerId!==s&&d.remove(),_.textContent=a.cardLikes.length,a.cardLikes.some((e=>e._id===s))&&l.classList.add("card__like-button_is-active"),p.addEventListener("click",n),d.addEventListener("click",(function(e){r(e.target,a.cardId)})),l.addEventListener("click",(function(e){const t=e.target;!function(e,t,n){t.classList.contains("card__like-button_is-active")?t.classList.contains("card__like-button_is-active")&&function(e){return fetch(`${c.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:c.headers}).then(o)}(e).then((e=>{t.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length})).catch(i):function(e){return fetch(`${c.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:c.headers}).then(o)}(e).then((e=>{t.classList.add("card__like-button_is-active"),n.textContent=e.likes.length})).catch(i)}(a.cardId,t,_)})),u}function s(e,t){(function(e){return fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(o)})(t).then((()=>{e.closest(".card").remove()})).catch(i)}function u(e,t){e.disabled=!0,e.classList.add(t)}function l(e,t,n,r,o){!function(e,t){e.disabled=!1,e.classList.remove(t)}(r,o),e.classList.remove(t),n.textContent=""}function d(e,t){const n=e.querySelectorAll(t.inputSelector),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){const o=e.querySelector(`.${n.id}__error_text`);l(n,t.inputErrorSelector,o,r,t.buttonDisabledSelector),u(r,t.buttonDisabledSelector)}))}let p;const f=document.querySelector(".content"),_=(Array.from(document.querySelectorAll(".form")),f.querySelector(".profile__add-button")),m=document.querySelector(".popup_type_new-card"),h=m.querySelector(".popup__close"),y=f.querySelector(".places__list"),v=document.querySelector(".popup_type_image"),S=v.querySelector(".popup__image"),b=v.querySelector(".popup__caption"),k=v.querySelector(".popup__close"),L=document.querySelector(".profile__edit-button"),E=document.querySelector(".popup_type_edit"),q=E.querySelector(".popup__close"),g=document.querySelector(".profile__info"),C=document.getElementById("avatar"),x=g.querySelector(".profile__title"),$=g.querySelector(".profile__description"),w=document.querySelector(".profile__image_change_button"),D=document.querySelector(".popup_type_changeAvatar"),I=D.querySelector(".popup__close"),U={formSelector:".popup__form",inputSelector:".popup__input",inputErrorSelector:"popup__input_validationError",submitButtonSelector:".popup__button",buttonDisabledSelector:"popup__button_disabled"},A=document.forms.newPlace,P=A.elements.link,T=A.elements.placeName,N=document.forms.editAvatar,B=N.elements.avatarLink,O=document.forms.editProfile,j=O.elements.name,J=O.elements.description;function M(e,t,n="Сохранить",r="Сохранение..."){t.textContent=e?r:n}function H(e,t="Сохранение..."){const n=e.submitter;M(!0,n,n.textContent,t)}function V(t){const n=t.target;e(v),S.src=n.src,b.textContent=n.alt,S.alt=n.alt}!function(e){document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),t.querySelectorAll(e.inputSelector).forEach((function(n){n.addEventListener("input",(function(){const r=t.querySelector(e.submitButtonSelector),o=t.querySelector(`.${n.id}__error_text`);!function(e,t,n,r,o){!function(e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity("")}(e),e.validity.valid?l(e,t,r,n,o):function(e,t,n,r,o){u(r,o),e.classList.add(t),n.textContent=e.validationMessage}(e,t,r,n,o)}(n,e.inputErrorSelector,r,o,e.buttonDisabledSelector)}))}))}))}(U),Promise.all([fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(o),fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(o)]).then((([e,t])=>{p=e._id,x.textContent=e.name,$.textContent=e.about,C.style.backgroundImage=`url('${e.avatar}')`,t.forEach((function(e){y.prepend(a(e.link,e.name,V,s,{cardId:e._id,cardLikes:e.likes,ownerId:e.owner._id},p))}))})).catch(i),k.addEventListener("click",(function(){t(v)})),w.addEventListener("click",(function(){e(D),d(N,U),B.value=""})),I.addEventListener("click",(function(){t(D)})),N.addEventListener("submit",(function(e){e.preventDefault(),function(e,n){H(n),function(e){return fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(o)}(e).then((()=>{C.style.backgroundImage=`url('${e}')`,t(D),N.reset()})).catch(i).finally((()=>{M(!1,n.submitter,"Сохранить")}))}(B.value,e)})),L.addEventListener("click",(function(){e(E),d(O,U),j.value=x.textContent,J.value=$.textContent})),q.addEventListener("click",(function(){t(E)})),O.addEventListener("submit",(function(e){e.preventDefault(),function(e,n,r){H(r),function(e,t){return fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(o)}(e,n).then((()=>{x.textContent=e,$.textContent=n,t(E),O.reset()})).catch(i).finally((()=>{M(!1,r.submitter,"Сохранить")}))}(j.value,J.value,e)})),_.addEventListener("click",(function(){e(m),d(A,U),A.reset()})),h.addEventListener("click",(function(){t(m)})),A.addEventListener("submit",(function(e){e.preventDefault(),H(e),function(e,t){return fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(o)}(T.value,P.value).then((e=>{t(m),A.reset(),y.prepend(a(e.link,e.name,V,s,{cardId:e._id,cardLikes:e.likes,ownerId:e.owner._id},p))})).catch(i).finally((()=>{M(!1,e.submitter,"Сохранить")}))}))})();